# Лабораторная работа №3

## Задание
 Сложный сайт. Необходимо применить ajax. Сервис видеокодирования. Необходимо написать сайт, который поддерживает регистрацию и логин, а также загрузку видеозаписей для перекодирования в другой формат (на ваш выбор), по готовности на странице появляется статус-сообщение и возможность загрузить результат перекодирования. Перекодирование можно сделать командой ffmpeg

## Решение
Проект разбит на 2 папки:

- `client` - Фронтенд для работы с сервером
- `server` - http-server

### Stack
- Front - [React](https://react.dev/)
- Backend - [rust](https://www.rust-lang.org/) + [actix_web](https://actix.rs/) в качестве веб фреймворка
- Обработка изображений - [ffmpeg](https://ffmpeg.org/)
- База данных - sqlite

### Как работает

Клиент загружает видео на сервер и, если запрос успешен, начинает слушать SSE со статусом загрузки

События
- started - сервер начал обработку видео, показываем лоадер
- competed - сервер закончил обработку и присылает ссылку на скачивание, показываем экран успеха и кнопку "Скачать"

Для обработки rust создает subprocess с вызовом `ffmpeg cli` и сохраняет результат локально, оригинал удаляется

### Getting Started
Для локального запуска клиента необходимо установить [rust](https://www.rust-lang.org/), [node](https://nodejs.org/en), [ffmpeg](https://ffmpeg.org/)

> Я использую pnpm для управлением зависимостями

#### Frontend
```bash
cd client
npm install
npm run dev
```
сайт запущен на http://locahost:5137/

#### Server
```bash
cd server
cargo run
```

### Auth
В проекте используется session-based авторизация 

### Testing
Для e2e тестов был выбран playwright, вместо selenium, так как его проще установить + возможно запустить в докере

Для проверки

```bash
cd client
npm run test
// Все тесты пройдены :)
```

### Docker
Внутри `server` и `client` лежат `Dockerfile` для сборки проектов

В корне находится `docker-compose.yml` для запуска фронта и бека и `start.sh` для старта проекта